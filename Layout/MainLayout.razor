@inherits LayoutComponentBase
@inject ThemeService ThemeService
@inject OffcanvasService OffcanvasService
@inject IJSRuntime JS
@implements IDisposable

<div class="page @(ThemeService.IsDarkMode ? "dark-theme" : "") @(OffcanvasService.IsOpen ? "offcanvas-open" : "")">
    <NavMenu />
    <main>
        <article class="content">
            @Body
        </article>
        <Footer />
    </main>
</div>

@code {
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            ThemeService.OnThemeChanged += HandleThemeChanged;
            OffcanvasService.OnOffcanvasChanged += HandleOffcanvasChanged;
            await ThemeService.InitializeAsync(JS);
            StateHasChanged();
        }
    }

    private void HandleThemeChanged()
    {
        StateHasChanged();
    }

    private void HandleOffcanvasChanged()
    {
        StateHasChanged();
    }

    public void Dispose()
    {
        ThemeService.OnThemeChanged -= HandleThemeChanged;
        OffcanvasService.OnOffcanvasChanged -= HandleOffcanvasChanged;
    }
}
