@page "/kategoriler"
@inject CategoryService CategoryService
@rendermode InteractiveServer

<PageTitle>Kategoriler - Emusell</PageTitle>

<div class="container py-4">
    <h1 class="mb-4"><i class="bi bi-tags me-2"></i>Kategoriler</h1>

    @if (mainCategories == null)
    {
        <div class="text-center py-5">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Yükleniyor...</span>
            </div>
        </div>
    }
    else
    {
        <div class="row g-4">
            @foreach (var mainCategory in mainCategories)
            {
                var subCats = GetSubcategoriesForMain(mainCategory.Id);
                <div class="col-12">
                    <div class="card category-card">
                        <div class="card-header d-flex align-items-center justify-content-between">
                            <a href="/kategoriler/@mainCategory.Slug" class="text-decoration-none">
                                <div class="d-flex align-items-center">
                                    <div class="category-icon bg-primary text-white rounded-circle d-inline-flex align-items-center justify-content-center me-3" style="width: 50px; height: 50px;">
                                        <i class="@mainCategory.Icon fs-4"></i>
                                    </div>
                                    <div>
                                        <h5 class="mb-0 text-dark">@mainCategory.Name</h5>
                                        <small class="text-muted">@mainCategory.Description</small>
                                    </div>
                                </div>
                            </a>
                            <a href="/kategoriler/@mainCategory.Slug" class="btn btn-outline-primary btn-sm">
                                Tümünü Gör <i class="bi bi-arrow-right ms-1"></i>
                            </a>
                        </div>
                        
                        @if (subCats?.Any() == true)
                        {
                            <div class="card-body">
                                <div class="row g-2">
                                    @foreach (var subCategory in subCats)
                                    {
                                        <div class="col-6 col-md-4 col-lg-3 col-xl-2">
                                            <a href="/kategoriler/@subCategory.Slug" class="text-decoration-none">
                                                <div class="subcategory-item p-2 rounded text-center">
                                                    <i class="@subCategory.Icon d-block mb-1 text-primary"></i>
                                                    <small class="text-dark">@subCategory.Name</small>
                                                </div>
                                            </a>
                                        </div>
                                    }
                                </div>
                            </div>
                        }
                    </div>
                </div>
            }
        </div>
    }
</div>

<style>
    .category-card {
        transition: box-shadow 0.2s;
    }
    .category-card:hover {
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    .subcategory-item {
        transition: background-color 0.2s;
        border: 1px solid transparent;
    }
    .subcategory-item:hover {
        background-color: rgba(99, 102, 241, 0.1);
        border-color: rgba(99, 102, 241, 0.2);
    }
</style>

@code {
    private List<Category>? mainCategories;
    private List<Category>? allSubCategories;

    protected override async Task OnInitializedAsync()
    {
        mainCategories = await CategoryService.GetMainCategoriesAsync();
        allSubCategories = await CategoryService.GetAllSubcategoriesAsync();
    }

    private List<Category>? GetSubcategoriesForMain(string mainCategoryId)
    {
        return allSubCategories?.Where(c => c.ParentCategoryId == mainCategoryId).OrderBy(c => c.Name).ToList();
    }
}
